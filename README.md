# hum2sol (WAV humming → solfege)

A small C++ tool that takes a **monophonic** (single melody) recording (you humming/singing) in **WAV** format and prints the detected melody as **solfege** (Do/Re/Mi…).

This project is designed to be easy to build on **Windows + VS Code** with **CMake** and **no heavy audio libraries**.

---

## What it does (v1)

- Reads a `.wav` file (mono or stereo; stereo is downmixed to mono)
- Runs **YIN pitch detection** per analysis frame
- Quantizes pitch to MIDI note numbers
- Applies stability logic to reduce jitter
- Outputs time + Hz + MIDI + solfege syllable

Example output:
```

t=0.91s  Hz=151.888  MIDI=51  solfege=Ri
t=2.52s  Hz=196.179  MIDI=55  solfege=So
...

```

---

## Requirements (Windows)

Install these:

1) **Visual Studio Build Tools 2022** (or full Visual Studio 2022)
- In the installer, select: **Desktop development with C++**
  - (This gives you MSVC compiler + Windows SDK)

2) **CMake**
- Install CMake for Windows and enable **“Add CMake to PATH”**

3) **VS Code extensions**
- **C/C++** (Microsoft)
- **CMake Tools** (Microsoft)

No other libraries are needed (we use `dr_wav.h` for reading WAV).

---

## Project structure

```

hum2sol/
CMakeLists.txt
README.md

third_party/
dr_wav.h

src/
main.cpp
audio/
wav_reader.h
wav_reader.cpp
dsp/
yin.h
yin.cpp
music/
pitch.h
pitch.cpp
solfege.h
solfege.cpp
segment.h
segment.cpp
smooth.h
smooth.cpp

build/            (generated by CMake; don’t commit)

````

---

## Build (VS Code)

1) Open the `hum2sol/` folder in VS Code  
2) `Ctrl+Shift+P` → **CMake: Configure** (select an MSVC kit)  
3) `Ctrl+Shift+P` → **CMake: Build**

The executable will be in one of these locations depending on generator/config:
- `build\Debug\hum2sol.exe`
- `build\Release\hum2sol.exe`

---

## Run

From the project root:

```powershell
.\build\Debug\hum2sol.exe --in .\hum.wav --mode movable --tonic C
````

### Modes

* `--mode movable` (default): Do = your chosen `--tonic`
* `--mode fixed`: Do = C (ignores `--tonic`)

### Tuning options

You can tweak these if it’s too noisy or missing notes:

* `--stableMs` : minimum time before accepting a note change
  Try: `90`, `120`, `160`
* `--yinThresh` : YIN threshold (lower = stricter)
  Try: `0.12` to `0.18`
* `--rmsGate` : silence threshold (higher = more aggressive)
  Try: `0.008` to `0.02`
* `--frameMs` / `--hopMs` : analysis window / hop
  Defaults are usually fine.

Example:

```powershell
.\build\Debug\hum2sol.exe --in .\hum.wav --mode movable --tonic C --stableMs 120 --yinThresh 0.12 --rmsGate 0.012
```

---

## Recording a WAV (important)

The program expects a **real WAV** file.

### If you already have a WAV

Make sure it’s actually `.wav`, not a renamed `.m4a`.

### If your recorder produces M4A/MP3

Convert to WAV with ffmpeg.

Install ffmpeg (Windows):

```powershell
winget install Gyan.FFmpeg
```

Convert:

```powershell
ffmpeg -i "input.m4a" -ac 1 -ar 44100 hum.wav
```

Then run:

```powershell
.\build\Debug\hum2sol.exe --in .\hum.wav --mode movable --tonic C
```

---

## Troubleshooting

### “Failed to open WAV”

* The file path is wrong OR the file is not a valid WAV.
  Check:

```powershell
Test-Path .\hum.wav
```

If you recorded `.m4a`, convert with ffmpeg (see above).

### “hum2sol.exe not recognized”

You’re running the wrong path (or it didn’t build).
Find it:

```powershell
Get-ChildItem -Recurse -Filter hum2sol.exe .\build | Select-Object FullName, LastWriteTime
```

### Output shows lots of `Ri/Fi/Di...`

That’s not necessarily wrong. It usually means your `--tonic` doesn’t match the melody’s “home note”.
Try a different tonic, e.g.:

```powershell
.\build\Debug\hum2sol.exe --in .\hum.wav --mode movable --tonic G
```

---

## Notes / limitations

* Works best for **single-note-at-a-time** humming/singing.
* Won’t do full-song polyphonic transcription (that’s a much harder problem).
* Solfege uses a chromatic set:
  `Do Di Re Ri Mi Fa Fi So Si La Li Ti`

---

## Next improvements (optional)

* Auto tonic/key detection
* Scale snapping (major/minor) to reduce chromatic syllables
* Live microphone input (PortAudio)
* Export to MIDI or MusicXML

```

If you want, I can also add a tiny `assets/examples/` section + a PowerShell script that runs a few preset commands so you can sanity-check quickly.
```
